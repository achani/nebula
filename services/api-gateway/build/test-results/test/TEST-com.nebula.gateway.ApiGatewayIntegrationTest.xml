<?xml version="1.0" encoding="UTF-8"?>
<testsuite name="com.nebula.gateway.ApiGatewayIntegrationTest" tests="1" skipped="0" failures="0" errors="0" timestamp="2026-02-26T12:22:50" hostname="ajays-mbp.lan" time="0.596">
  <properties/>
  <testcase name="testUnauthorizedRequest()" classname="com.nebula.gateway.ApiGatewayIntegrationTest" time="0.596"/>
  <system-out><![CDATA[13:22:01.965 [Test worker] INFO org.testcontainers.images.PullPolicy -- Image pull policy will be performed by: DefaultPullPolicy()
13:22:01.969 [Test worker] INFO org.testcontainers.utility.ImageNameSubstitutor -- Image name substitution will be performed by: DefaultImageNameSubstitutor (composite of 'ConfigurationFileImageNameSubstitutor' and 'PrefixingImageNameSubstitutor')
13:22:02.228 [Test worker] INFO org.testcontainers.dockerclient.DockerClientProviderStrategy -- Found Docker environment with local Unix socket (unix:///var/run/docker.sock)
13:22:02.234 [Test worker] INFO org.testcontainers.DockerClientFactory -- Docker host IP address is localhost
13:22:02.254 [Test worker] INFO org.testcontainers.DockerClientFactory -- Connected to docker: 
  Server Version: 24.0.6
  API Version: 1.43
  Operating System: Docker Desktop
  Total Memory: 7851 MB
13:22:02.283 [Test worker] INFO tc.testcontainers/ryuk:0.6.0 -- Pulling docker image: testcontainers/ryuk:0.6.0. Please be patient; this may take some time but only needs to be done once.
13:22:02.653 [Test worker] INFO org.testcontainers.utility.RegistryAuthLocator -- Credential helper/store (docker-credential-desktop) does not have credentials for https://index.docker.io/v1/
13:22:04.731 [docker-java-stream--623331358] INFO tc.testcontainers/ryuk:0.6.0 -- Starting to pull image
13:22:04.743 [docker-java-stream--623331358] INFO tc.testcontainers/ryuk:0.6.0 -- Pulling image layers:  0 pending,  0 downloaded,  0 extracted, (0 bytes/0 bytes)
13:22:06.030 [docker-java-stream--623331358] INFO tc.testcontainers/ryuk:0.6.0 -- Pulling image layers:  2 pending,  1 downloaded,  0 extracted, (340 KB/? MB)
13:22:06.097 [docker-java-stream--623331358] INFO tc.testcontainers/ryuk:0.6.0 -- Pulling image layers:  1 pending,  2 downloaded,  0 extracted, (4 MB/? MB)
13:22:06.128 [docker-java-stream--623331358] INFO tc.testcontainers/ryuk:0.6.0 -- Pulling image layers:  0 pending,  3 downloaded,  0 extracted, (4 MB/6 MB)
13:22:06.254 [docker-java-stream--623331358] INFO tc.testcontainers/ryuk:0.6.0 -- Pulling image layers:  0 pending,  3 downloaded,  1 extracted, (5 MB/6 MB)
13:22:06.324 [docker-java-stream--623331358] INFO tc.testcontainers/ryuk:0.6.0 -- Pulling image layers:  0 pending,  3 downloaded,  2 extracted, (5 MB/6 MB)
13:22:06.359 [docker-java-stream--623331358] INFO tc.testcontainers/ryuk:0.6.0 -- Pulling image layers:  0 pending,  3 downloaded,  3 extracted, (6 MB/6 MB)
13:22:06.365 [Test worker] INFO tc.testcontainers/ryuk:0.6.0 -- Image testcontainers/ryuk:0.6.0 pull took PT4.081579S
13:22:06.365 [docker-java-stream--623331358] INFO tc.testcontainers/ryuk:0.6.0 -- Pull complete. 3 layers, pulled in 1s (downloaded 6 MB at 6 MB/s)
13:22:06.390 [Test worker] INFO tc.testcontainers/ryuk:0.6.0 -- Creating container for image: testcontainers/ryuk:0.6.0
13:22:06.463 [Test worker] INFO tc.testcontainers/ryuk:0.6.0 -- Container testcontainers/ryuk:0.6.0 is starting: 477eefba1c79911a831e9748870d39cc3e1916240d4b124d2c9121819f9aa588
13:22:06.681 [Test worker] INFO tc.testcontainers/ryuk:0.6.0 -- Container testcontainers/ryuk:0.6.0 started in PT0.291611S
13:22:06.692 [Test worker] INFO org.testcontainers.utility.RyukResourceReaper -- Ryuk started - will monitor and terminate Testcontainers containers on JVM exit
13:22:06.692 [Test worker] INFO org.testcontainers.DockerClientFactory -- Checking the system...
13:22:06.693 [Test worker] INFO org.testcontainers.DockerClientFactory -- ✔︎ Docker server version should be at least 1.6.0
13:22:06.696 [Test worker] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Pulling docker image: quay.io/keycloak/keycloak:24.0.0. Please be patient; this may take some time but only needs to be done once.
13:22:06.859 [Test worker] INFO org.testcontainers.utility.RegistryAuthLocator -- Credential helper/store (docker-credential-desktop) does not have credentials for quay.io
13:22:09.355 [docker-java-stream--138156290] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Starting to pull image
13:22:09.359 [docker-java-stream--138156290] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Pulling image layers:  0 pending,  0 downloaded,  0 extracted, (0 bytes/0 bytes)
13:22:11.210 [docker-java-stream--138156290] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Pulling image layers:  4 pending,  1 downloaded,  0 extracted, (549 bytes/? MB)
13:22:17.593 [docker-java-stream--138156290] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Pulling image layers:  3 pending,  2 downloaded,  0 extracted, (98 MB/? MB)
13:22:19.321 [docker-java-stream--138156290] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Pulling image layers:  3 pending,  2 downloaded,  1 extracted, (103 MB/? MB)
13:22:31.876 [docker-java-stream--138156290] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Pulling image layers:  2 pending,  3 downloaded,  1 extracted, (241 MB/? MB)
13:22:32.952 [docker-java-stream--138156290] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Pulling image layers:  2 pending,  3 downloaded,  2 extracted, (241 MB/? MB)
13:22:32.963 [docker-java-stream--138156290] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Pulling image layers:  2 pending,  3 downloaded,  3 extracted, (241 MB/? MB)
13:22:32.975 [Test worker] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Image quay.io/keycloak/keycloak:24.0.0 pull took PT26.279078S
13:22:32.975 [docker-java-stream--138156290] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Pull complete. 5 layers, pulled in 23s (downloaded 241 MB at 10 MB/s)
13:22:32.987 [Test worker] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Creating container for image: quay.io/keycloak/keycloak:24.0.0
13:22:33.131 [Test worker] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Container quay.io/keycloak/keycloak:24.0.0 is starting: 2410446b41ee8500f9bc08a52f378626b0ff8a0e7d666bbe443dc6fda9233214
13:22:33.282 [Test worker] INFO org.testcontainers.containers.wait.strategy.HttpWaitStrategy -- /fervent_carson: Waiting for 120 seconds for URL: http://localhost:56003 (where port 56003 maps to container port 8080)
13:22:33.828 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: Updating the configuration and installing your custom providers, if any. Please wait.
13:22:39.256 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:39,252 INFO  [io.qua.dep.QuarkusAugmentor] (main) Quarkus augmentation completed in 4840ms
13:22:41.925 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:40,262 INFO  [org.keycloak.quarkus.runtime.hostname.DefaultHostnameProvider] (main) Hostname settings: Base URL: <unset>, Hostname: <request>, Strict HTTPS: false, Path: <request>, Strict BackChannel: false, Admin URL: <unset>, Admin: <request>, Port: -1, Proxied: false
13:22:41.926 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:40,412 WARN  [org.infinispan.CONFIG] (keycloak-cache-init) ISPN000569: Unable to persist Infinispan internal caches as no global state enabled
13:22:41.926 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:40,449 INFO  [org.infinispan.CONTAINER] (keycloak-cache-init) ISPN000556: Starting user marshaller 'org.infinispan.jboss.marshalling.core.JBossUserMarshaller'
13:22:41.969 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:41,968 WARN  [io.quarkus.agroal.runtime.DataSources] (JPA Startup Thread) Datasource <default> enables XA but transaction recovery is not enabled. Please enable transaction recovery by setting quarkus.transaction-manager.enable-recovery=true, otherwise data may be lost if the application is terminated abruptly
13:22:43.596 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:43,595 INFO  [org.keycloak.quarkus.runtime.storage.legacy.liquibase.QuarkusJpaUpdaterProvider] (main) Initializing database schema. Using changelog META-INF/jpa-changelog-master.xml
13:22:44.729 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 
13:22:44.729 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: UPDATE SUMMARY
13:22:44.729 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: Run:                        121
13:22:44.729 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: Previously run:               0
13:22:44.729 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: Filtered out:                 0
13:22:44.729 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: -------------------------------
13:22:44.730 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: Total change sets:          121
13:22:44.730 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 
13:22:44.824 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:44,824 INFO  [org.keycloak.connections.infinispan.DefaultInfinispanConnectionProviderFactory] (main) Node name: node_999390, Site name: null
13:22:44.967 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:44,966 INFO  [org.keycloak.broker.provider.AbstractIdentityProviderMapper] (main) Registering class org.keycloak.broker.provider.mappersync.ConfigSyncEventListener
13:22:45.004 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:45,003 INFO  [org.keycloak.services] (main) KC-SERVICES0050: Initializing master realm
13:22:46.077 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:46,076 INFO  [org.keycloak.exportimport.dir.DirImportProvider] (main) Importing from directory /opt/keycloak/bin/../data/import
13:22:46.077 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:46,076 INFO  [org.keycloak.services] (main) KC-SERVICES0030: Full model import requested. Strategy: IGNORE_EXISTING
13:22:47.280 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:47,279 INFO  [org.keycloak.exportimport.util.ImportUtils] (main) Realm 'nebula' imported
13:22:47.350 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:47,350 INFO  [org.keycloak.services] (main) KC-SERVICES0032: Import finished successfully
13:22:47.425 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:47,424 INFO  [io.quarkus] (main) Keycloak 24.0.0 on JVM (powered by Quarkus 3.8.1) started in 7.998s. Listening on: http://0.0.0.0:8080
13:22:47.425 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:47,424 INFO  [io.quarkus] (main) Profile dev activated. 
13:22:47.425 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:47,424 INFO  [io.quarkus] (main) Installed features: [agroal, cdi, hibernate-orm, jdbc-h2, keycloak, logging-gelf, narayana-jta, reactive-routes, resteasy-reactive, resteasy-reactive-jackson, smallrye-context-propagation, vertx]
13:22:47.674 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:47,673 INFO  [org.keycloak.services] (main) KC-SERVICES0009: Added user 'admin' to realm 'master'
13:22:47.675 [docker-java-stream-1300332561] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- STDOUT: 2026-02-26 12:22:47,674 WARN  [org.keycloak.quarkus.runtime.KeycloakMain] (main) Running the server in development mode. DO NOT use this configuration in production.
13:22:48.594 [Test worker] INFO tc.quay.io/keycloak/keycloak:24.0.0 -- Container quay.io/keycloak/keycloak:24.0.0 started in PT15.607113S
13:22:48.656 [Test worker] INFO org.springframework.test.context.support.AnnotationConfigContextLoaderUtils -- Could not detect default configuration classes for test class [com.nebula.gateway.ApiGatewayIntegrationTest]: ApiGatewayIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
13:22:48.699 [Test worker] INFO org.springframework.boot.test.context.SpringBootTestContextBootstrapper -- Found @SpringBootConfiguration com.nebula.gateway.ApiGatewayApplication for test class com.nebula.gateway.ApiGatewayIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.4)

2026-02-26T13:22:48.940+01:00  INFO 29328 --- [api-gateway] [    Test worker] c.n.gateway.ApiGatewayIntegrationTest    : Starting ApiGatewayIntegrationTest using Java 21.0.1 with PID 29328 (started by ajay in /Users/ajay/dev/projects/gemini/Foundry/services/api-gateway)
2026-02-26T13:22:48.941+01:00  INFO 29328 --- [api-gateway] [    Test worker] c.n.gateway.ApiGatewayIntegrationTest    : No active profile set, falling back to 1 default profile: "default"
2026-02-26T13:22:49.422+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.cloud.context.scope.GenericScope     : BeanFactory id=8bf46f90-f27b-3809-9ab5-a53440b57779
2026-02-26T13:22:49.878+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [After]
2026-02-26T13:22:49.878+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [Before]
2026-02-26T13:22:49.878+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [Between]
2026-02-26T13:22:49.878+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [Cookie]
2026-02-26T13:22:49.879+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [Header]
2026-02-26T13:22:49.879+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [Host]
2026-02-26T13:22:49.879+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [Method]
2026-02-26T13:22:49.879+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [Path]
2026-02-26T13:22:49.879+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [Query]
2026-02-26T13:22:49.879+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [ReadBody]
2026-02-26T13:22:49.879+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [RemoteAddr]
2026-02-26T13:22:49.879+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [XForwardedRemoteAddr]
2026-02-26T13:22:49.879+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [Weight]
2026-02-26T13:22:49.879+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [CloudFoundryRouteService]
2026-02-26T13:22:49.962+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.b.a.e.web.EndpointLinksResolver      : Exposing 1 endpoint(s) beneath base path '/actuator'
2026-02-26T13:22:50.186+01:00  INFO 29328 --- [api-gateway] [    Test worker] o.s.b.web.embedded.netty.NettyWebServer  : Netty started on port 56043
2026-02-26T13:22:50.211+01:00  INFO 29328 --- [api-gateway] [    Test worker] c.n.gateway.ApiGatewayIntegrationTest    : Started ApiGatewayIntegrationTest in 1.447 seconds (process running for 48.645)
2026-02-26T13:22:50.723+01:00 ERROR 29328 --- [api-gateway] [    Test worker] i.n.r.d.DnsServerAddressStreamProviders  : Unable to load io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider, fallback to system defaults. This may result in incorrect DNS resolutions on MacOS. Check whether you have a dependency on 'io.netty:netty-resolver-dns-native-macos'. Use DEBUG level to see the full stack: java.lang.UnsatisfiedLinkError: failed to load the required native library
]]></system-out>
  <system-err><![CDATA[WARNING: A Java agent has been loaded dynamically (/Users/ajay/.gradle/caches/modules-2/files-2.1/net.bytebuddy/byte-buddy-agent/1.14.12/be4984cb6fd1ef1d11f218a648889dfda44b8a15/byte-buddy-agent-1.14.12.jar)
WARNING: If a serviceability tool is in use, please run with -XX:+EnableDynamicAgentLoading to hide this warning
WARNING: If a serviceability tool is not in use, please run with -Djdk.instrument.traceUsage for more information
WARNING: Dynamic loading of agents will be disallowed by default in a future release
]]></system-err>
</testsuite>
